<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>AAX SDK: MIDI</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="aaxdoxy.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="cw_105x65_aax_buf.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">AAX SDK
   &#160;<span id="projectnumber">2.3.1</span>
   </div>
   <div id="projectbrief">Avid Audio Extensions Development Kit</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Welcome</span></a></li>
      <li><a href="modules.html"><span>Manual</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="pages.html"><span>Lists</span></a></li>
      <li><a href="usergroup0.html"><span>Support</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">MIDI<div class="ingroups"><a class="el" href="a00323.html">AAX SDK Manual</a> &raquo; <a class="el" href="a00332.html">Additional AAX features</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<p>How to route and process MIDI in AAX plug-ins. </p>
<h1><a class="anchor" id="additionalFeatures_MIDI_Overview"></a>
Midi Overview</h1>
<p>DirectMidi is Avid's protocol for communication of MIDI and other timing-critical plug-in information. It is a cross-platform solution to tightly integrate the host application, audio engine, and plug-ins.</p>
<h1><a class="anchor" id="additionalFeatures_MIDI_NodeTypes"></a>
MIDI node types</h1>
<p>There are four kinds of nodes an AAX plug-in can create. See <a class="el" href="a00206.html#a5e1dffce35d05990dbbad651702678e4">AAX_EMIDINodeType</a> for additional details about these node types: </p><ul>
<li><a class="el" href="a00206.html#a5e1dffce35d05990dbbad651702678e4ae57de2b04978fe2e75f5bdeb034bda44">AAX_eMIDINodeType_LocalInput</a> </li>
<li><a class="el" href="a00206.html#a5e1dffce35d05990dbbad651702678e4acc1b5f2109c508b20a65b5e0fdcd643f">AAX_eMIDINodeType_LocalOutput</a> </li>
<li><a class="el" href="a00206.html#a5e1dffce35d05990dbbad651702678e4a2be91828f8c1dac20ab5dff136fc1fce">AAX_eMIDINodeType_Global</a> </li>
<li><a class="el" href="a00206.html#a5e1dffce35d05990dbbad651702678e4ac2ff856aec0724907dfd95b8e3ccbc20">AAX_eMIDINodeType_Transport</a></li>
</ul>
<h1><a class="anchor" id="additionalFeatures_MIDI_AddingMIDI"></a>
Adding MIDI functionality to a plug-in</h1>
<p>Plug-in may access MIDI data in its algorithm or data model. If plug-in needs MIDI in both places or just in the algorithm, it should add a MIDI node to the algorithm context, i.e. call <a class="el" href="a00088.html#a6284dda9ccca898e33075de29dad4e39">AAX_IComponentDescriptor::AddMIDINode()</a> with the appropriate node type.</p>
<div class="fragment"><div class="line"><span class="comment">//==============================================================================</span></div>
<div class="line"><span class="comment">// Algorithm context definitions</span></div>
<div class="line"><span class="comment">//==============================================================================</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// Context structure</span></div>
<div class="line"><span class="keyword">struct </span>SMy_Alg_Context</div>
<div class="line">{</div>
<div class="line">    [...]</div>
<div class="line">    <a class="code" href="a00105.html">AAX_IMIDINode</a>   * mMIDIInNodeP;         <span class="comment">// Local input MIDI node pointer</span></div>
<div class="line">    <a class="code" href="a00105.html">AAX_IMIDINode</a>   * mMIDINodeOutP;        <span class="comment">// Local output MIDI node pointer</span></div>
<div class="line">    <a class="code" href="a00105.html">AAX_IMIDINode</a>   * mMIDINodeTransportP;  <span class="comment">// Transport node </span></div>
<div class="line">    [...]</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">enum</span> EDemoMIDI_Alg_PortID</div>
<div class="line">{</div>
<div class="line">    [...]</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Add the MIDI node as a physical address within the context field</span></div>
<div class="line">    ,eAlgPortID_MIDINodeIn          = <a class="code" href="a00149.html#acf807247ecd6e5899dc9dc31644e9a1d">AAX_FIELD_INDEX</a> (SDemoMIDI_Alg_Context, mMIDINodeP)</div>
<div class="line">    ,eAlgPortID_MIDINodeOut         = <a class="code" href="a00149.html#acf807247ecd6e5899dc9dc31644e9a1d">AAX_FIELD_INDEX</a> (SDemoMIDI_Alg_Context, mMIDINodeOutP)</div>
<div class="line">    ,eAlgPortID_MIDINodeTransport   = <a class="code" href="a00149.html#acf807247ecd6e5899dc9dc31644e9a1d">AAX_FIELD_INDEX</a> (SDemoMIDI_Alg_Context, mMIDINodeTransportP)</div>
<div class="line">    [...]</div>
<div class="line">};</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="comment">// ***************************************************************************</span></div>
<div class="line"><span class="comment">// ROUTINE: DescribeAlgorithmComponent</span></div>
<div class="line"><span class="comment">// Algorithm component description</span></div>
<div class="line"><span class="comment">// ***************************************************************************</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> DescribeAlgorithmComponent( <a class="code" href="a00088.html">AAX_IComponentDescriptor</a> * outDesc )</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="a00149.html#a4d8f69a697df7f70c3a8e9b8ee130d2f">AAX_Result</a>                  err;</div>
<div class="line">    </div>
<div class="line">    [...]</div>
<div class="line">    <span class="comment">// Register MIDI nodes</span></div>
<div class="line">    err = outDesc-&gt;<a class="code" href="a00088.html#a6284dda9ccca898e33075de29dad4e39">AddMIDINode</a>(eAlgPortID_MIDINodeA, <a class="code" href="a00206.html#a5e1dffce35d05990dbbad651702678e4ae57de2b04978fe2e75f5bdeb034bda44">AAX_eMIDINodeType_LocalInput</a>, <span class="stringliteral">&quot;DemoMIDI&quot;</span>, 0xffff);                 <a class="code" href="a00158.html#a168ee44fd7a5485ab50160db36fb2988">AAX_ASSERT</a> (err == 0);</div>
<div class="line">    err = outDesc-&gt;<a class="code" href="a00088.html#a6284dda9ccca898e33075de29dad4e39">AddMIDINode</a>(eAlgPortID_MIDINodeOut, <a class="code" href="a00206.html#a5e1dffce35d05990dbbad651702678e4acc1b5f2109c508b20a65b5e0fdcd643f">AAX_eMIDINodeType_LocalOutput</a>, <span class="stringliteral">&quot;DemoMIDIOut&quot;</span>, 0xffff);           <a class="code" href="a00158.html#a168ee44fd7a5485ab50160db36fb2988">AAX_ASSERT</a> (err == 0);</div>
<div class="line">    err = outDesc-&gt;<a class="code" href="a00088.html#a6284dda9ccca898e33075de29dad4e39">AddMIDINode</a>(eAlgPortID_MIDINodeTransport, <a class="code" href="a00206.html#a5e1dffce35d05990dbbad651702678e4ac2ff856aec0724907dfd95b8e3ccbc20">AAX_eMIDINodeType_Transport</a>, <span class="stringliteral">&quot;DemoMIDITrnsprt&quot;</span>, 0xffff);   <a class="code" href="a00158.html#a168ee44fd7a5485ab50160db36fb2988">AAX_ASSERT</a> (err == 0);</div>
<div class="line">    [...]</div>
<div class="line">}</div>
</div><!-- fragment --><p>If MIDI data is needed in the plug-in's data model only, plug-in should describe MIDI node with <a class="el" href="a00096.html#aa7709de005e0256feb522758ccc5b582">AAX_IEffectDescriptor::AddControlMIDINode()</a>.</p>
<div class="fragment"><div class="line"><span class="comment">// ***************************************************************************</span></div>
<div class="line"><span class="comment">// ROUTINE: GetPlugInDescription</span></div>
<div class="line"><span class="comment">// ***************************************************************************</span></div>
<div class="line"><span class="keyword">static</span> <a class="code" href="a00149.html#a4d8f69a697df7f70c3a8e9b8ee130d2f">AAX_Result</a> GetPlugInDescription( <a class="code" href="a00096.html">AAX_IEffectDescriptor</a> * outDescriptor )</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="a00149.html#a4d8f69a697df7f70c3a8e9b8ee130d2f">AAX_Result</a>                  err;</div>
<div class="line">    </div>
<div class="line">    [...]</div>
<div class="line">    <span class="comment">// Register MIDI nodes</span></div>
<div class="line">    err = outDesc-&gt;AddControlMIDINode(<span class="stringliteral">&#39;linp&#39;</span>, <a class="code" href="a00206.html#a5e1dffce35d05990dbbad651702678e4ae57de2b04978fe2e75f5bdeb034bda44">AAX_eMIDINodeType_LocalInput</a>, <span class="stringliteral">&quot;DemoMIDI&quot;</span>, 0xffff);        <a class="code" href="a00158.html#a168ee44fd7a5485ab50160db36fb2988">AAX_ASSERT</a> (err == 0);</div>
<div class="line">    err = outDesc-&gt; AddControlMIDINode(<span class="stringliteral">&#39;lout&#39;</span>, <a class="code" href="a00206.html#a5e1dffce35d05990dbbad651702678e4acc1b5f2109c508b20a65b5e0fdcd643f">AAX_eMIDINodeType_LocalOutput</a>, <span class="stringliteral">&quot;DemoMIDIOut&quot;</span>, 0xffff);   <a class="code" href="a00158.html#a168ee44fd7a5485ab50160db36fb2988">AAX_ASSERT</a> (err == 0);</div>
<div class="line">    err = outDesc-&gt; AddControlMIDINode(<span class="stringliteral">&#39;tran&#39;</span>, <a class="code" href="a00206.html#a5e1dffce35d05990dbbad651702678e4ac2ff856aec0724907dfd95b8e3ccbc20">AAX_eMIDINodeType_Transport</a>, <span class="stringliteral">&quot;DemoMIDITrnsprt&quot;</span>, 0xffff); <a class="code" href="a00158.html#a168ee44fd7a5485ab50160db36fb2988">AAX_ASSERT</a> (err == 0);</div>
<div class="line">    [...]</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> err;</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>These two types of MIDI nodes can't be used together in the same plug-in's effect.</dd></dl>
<h1><a class="anchor" id="additionalFeatures_MIDI_Algorithm"></a>
Using MIDI in a plug-in algorithm</h1>
<p>Like with other algorithm context ports, data in MIDI nodes is directly available in the plug-in's algorithm process function. Here is an example from the DemoMIDI_NoteOn sample plug-in:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keywordtype">int</span> kNumChannelsIn, <span class="keywordtype">int</span> kNumChannelsOut&gt; </div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line"><a class="code" href="a00149.html#aaa22112139aa627574b1ef562f579d43">AAX_CALLBACK</a></div>
<div class="line">DemoMIDI_AlgorithmProcessFunction (</div>
<div class="line">                                   SDemoMIDI_Alg_Context * <span class="keyword">const</span>    inInstancesBegin [],</div>
<div class="line">                                   <span class="keyword">const</span> <span class="keywordtype">void</span> *                 inInstancesEnd)</div>
<div class="line">{</div>
<div class="line">    [...]</div>
<div class="line">    <span class="comment">// Setup MIDI In node pointers </span></div>
<div class="line">    <a class="code" href="a00105.html">AAX_IMIDINode</a>* midiNodeIn = instance-&gt;mMIDINodeP;</div>
<div class="line">    <a class="code" href="a00025.html">AAX_CMidiStream</a>* midiBufferIn = midiNodeIn-&gt;<a class="code" href="a00105.html#a794f1c0d19ac6720382c23b0a4dc2b17">GetNodeBuffer</a>();</div>
<div class="line">    <a class="code" href="a00024.html">AAX_CMidiPacket</a>* midiBufferInPtr = midiBufferIn-&gt;<a class="code" href="a00025.html#a5011ea886dce57b382c23b82e56d3000">mBuffer</a>;</div>
<div class="line">    uint32_t packets_count_in = midiBufferIn-&gt;<a class="code" href="a00025.html#ad93c962a8278977f2a4f07b1e7490a90">mBufferSize</a>;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Setup MIDI Out node pointers </span></div>
<div class="line">    <a class="code" href="a00105.html">AAX_IMIDINode</a>* midiNodeOut = instance-&gt;mMIDINodeOutP;</div>
<div class="line">    <a class="code" href="a00025.html">AAX_CMidiStream</a>* midiBufferOut = midiNodeOut-&gt;<a class="code" href="a00105.html#a794f1c0d19ac6720382c23b0a4dc2b17">GetNodeBuffer</a>();</div>
<div class="line">    <a class="code" href="a00024.html">AAX_CMidiPacket</a>* midiBufferOutPtr = midiBufferOut-&gt;<a class="code" href="a00025.html#a5011ea886dce57b382c23b82e56d3000">mBuffer</a>;</div>
<div class="line">    uint32_t packets_count_out = midiBufferOut-&gt;<a class="code" href="a00025.html#ad93c962a8278977f2a4f07b1e7490a90">mBufferSize</a>;</div>
<div class="line"></div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Setup MIDI Transport node pointers </span></div>
<div class="line">    <a class="code" href="a00105.html">AAX_IMIDINode</a>* midiTransport = instance-&gt;mMIDINodeTransportP;</div>
<div class="line">    <a class="code" href="a00116.html">AAX_ITransport</a> * transport = midiTransport-&gt;<a class="code" href="a00105.html#a57bd132ee74047e25298b157c0bff2f9">GetTransport</a>();</div>
<div class="line">    <span class="keywordtype">bool</span> transport_is_playing = <span class="keyword">false</span>;</div>
<div class="line">    <span class="keywordflow">if</span> (transport)</div>
<div class="line">        transport-&gt;<a class="code" href="a00116.html#a8f7d5b8f65ff9dd456a395838c974715">IsTransportPlaying</a>(&amp;transport_is_playing);</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span>(transport_is_playing)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="comment">// While there are packets in the node</span></div>
<div class="line">        <span class="keywordflow">while</span> (packets_count_in &gt; 0)</div>
<div class="line">        {</div>
<div class="line">            midiBufferOutPtr = midiBufferInPtr;         <span class="comment">// Copy the packet from the input MIDI node </span></div>
<div class="line">                                        <span class="comment">// to the output MIDI node</span></div>
<div class="line">            midiBufferOutPtr-&gt;<a class="code" href="a00024.html#a76df0e71968aa1416b93015ebf23ddc5">mTimestamp</a> = timeStamp;       <span class="comment">// Set the MIDI time stamp</span></div>
<div class="line">            midiNodeOut-&gt;<a class="code" href="a00105.html#a5e1c5409158164f57376f908c9693a8b">PostMIDIPacket</a>(midiBufferOutPtr);  <span class="comment">// Post the MIDI packet</span></div>
<div class="line">            midiBufferOut-&gt;<a class="code" href="a00025.html#ad93c962a8278977f2a4f07b1e7490a90">mBufferSize</a> = packets_count_in;   </div>
<div class="line">                            </div>
<div class="line">            midiBufferInPtr++;</div>
<div class="line">            packets_count_in--;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    [...]</div>
<div class="line">}   </div>
</div><!-- fragment --><p>Also data from the MIDI nodes that were described with <a class="el" href="a00088.html#a6284dda9ccca898e33075de29dad4e39">AAX_IComponentDescriptor::AddMIDINode()</a> can be accessed via <a class="el" href="a00018.html#a900a8fcf7d2e0bebda33e5ac393019c2">AAX_CEffectParameters::UpdateMIDINodes()</a> method. This method provides an <a class="el" href="a00024.html">AAX_CMidiPacket</a>. Because the MIDI packet structure does not identify the associated MIDI stream's type (input, output, global, or transport) this method also provides an index into the plug-in's algorithm context structure which can be used to identify the semantics of the MIDI packet.</p>
<h1><a class="anchor" id="additionalFeatures_MIDI_DataModel"></a>
Accessing MIDI in the plug-in data model</h1>
<p>A plug-in may access MIDI data in its data model via the <a class="el" href="a00018.html#a900a8fcf7d2e0bebda33e5ac393019c2">AAX_CEffectParameters::UpdateMIDINodes()</a> or <a class="el" href="a00018.html#aeaaaad6ff1a84c8fc66dcdfd8bc430c5">AAX_CEffectParameters::UpdateControlMIDINodes()</a> methods. Both of these methods provide an <a class="el" href="a00024.html">AAX_CMidiPacket</a>. Because the MIDI packet structure does not identify the associated MIDI stream's type (input, output, global, or transport) UpdateMIDINodes method also provides an index into the plug-in's algorithm context structure which can be used to identify the semantics of the MIDI packet, while UpdateControlMIDINodes provides MIDI node ID for the same reason.</p>
<div class="fragment"><div class="line"><a class="code" href="a00149.html#a4d8f69a697df7f70c3a8e9b8ee130d2f">AAX_Result</a> DemoMIDI_Parameters::UpdateMIDINodes ( <a class="code" href="a00149.html#ae807f8986143820cfb5d6da32165c9c7">AAX_CFieldIndex</a> inFieldIndex, <a class="code" href="a00024.html">AAX_CMidiPacket</a>&amp; inPacket )</div>
<div class="line">{   </div>
<div class="line">    <span class="keywordflow">if</span> (eAlgPortID_MIDINodeIn == inFieldIndex)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> ( (inPacket.<a class="code" href="a00024.html#aac7229afc36006bc673eb219b18d8220">mData</a>[0] &amp; 0xF0) == 0x90 )</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> ( inPacket.<a class="code" href="a00024.html#aac7229afc36006bc673eb219b18d8220">mData</a>[2] == 0x00 )</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">//  Note Off</span></div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// Note On</span></div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="a00207.html#a5f8c7439f3a706c4f8315a9609811937aeddbd1bb67e3a66e6af54a4b4a7a57b3">AAX_SUCCESS</a>;</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Only one of the UpdateMIDINodes and UpdateControlMIDINodes can be used in the single plug-in's effect at a time. If plug-in uses MIDI nodes described with AddMIDINode function, then only UpdateMIDINodes method can be used to receive MIDI messages. Otherwise UpdateControlMIDINodes should be used. </dd></dl>
<div class="dynheader">
Collaboration diagram for MIDI:</div>
<div class="dyncontent">
<center><table><tr><td><img src="a00336.png" border="0" alt="" usemap="#a00336"/>
<map name="a00336" id="a00336">
<area shape="rect" id="node1" href="a00332.html" title="How to use additional features and functionality supported by AAX. " alt="" coords="5,5,168,32"/></map>
</td></tr></table></center>
</div>
</div><!-- contents -->
<!--        Copyright 2016, 2018 by Avid Technology, Inc.        -->
<!-- HTML footer for doxygen 1.8.9.1-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
<div class="FooterLegal">This product may be protected by one or more U.S. and non-U.S. patents. Details are available at <a href="https://www.avid.com/patents">www.avid.com/patents</a>.</div>
Generated on Fri Feb 2 2018 21:14:32 for AAX SDK by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
