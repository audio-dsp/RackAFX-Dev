<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>AAX SDK: Linked parameters</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="aaxdoxy.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="cw_105x65_aax_buf.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">AAX SDK
   &#160;<span id="projectnumber">2.3.1</span>
   </div>
   <div id="projectbrief">Avid Audio Extensions Development Kit</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Welcome</span></a></li>
      <li><a href="modules.html"><span>Manual</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="pages.html"><span>Lists</span></a></li>
      <li><a href="usergroup0.html"><span>Support</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Linked parameters<div class="ingroups"><a class="el" href="a00323.html">AAX SDK Manual</a> &raquo; <a class="el" href="a00348.html">Additional Topics</a> &raquo; <a class="el" href="a00350.html">Parameter updates</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<p>How to link parameters. </p>
<h1><a class="anchor" id="linkedParameters_contents"></a>
On this page</h1>
<ul>
<li><a class="el" href="a00354.html#linkedParameters_basics">Basics of Linked Parameters</a> </li>
<li><a class="el" href="a00354.html#linkedParameters_linkedParameterOperation">Linked Parameter Operation</a> </li>
<li><a class="el" href="a00354.html#linkedParameters_changingTapers">Changing Tapers</a></li>
</ul>
<h1><a class="anchor" id="linkedParameters_basics"></a>
Basics of Linked Parameters</h1>
<p>A "linked" parameter can be defined as any parameter whose state is somehow dependent on another parameter. Within this general definition, there are various different kinds of parameter linking:</p>
<ul>
<li>Linking behavior can operate one-way or parameters can be reciprocally linked</li>
<li>Linking between parameters can be one-to-one or one-to-many</li>
</ul>
<h2><a class="anchor" id="linkedParameters_considerations"></a>
Basic considerations for parameter linking</h2>
<p>Although the concept of parameter linking is simple, implementing linked parameter behavior that is intuitive and consistent can require careful design.</p>
<ul>
<li>Parameter interdependencies and constraints can become complex, especially when handling multiple sets of linked parameters.</li>
<li>Linked parameters that update other parameters during playback can result in subtle timing inconsistencies</li>
<li>Automated parameters may contain arbitrary and conflicting automation data</li>
<li>A user may attempt to edit multiple linked parameters simultaneously during playback, e.g. using multiple encoders on a control surface</li>
<li>A plug-in may contain dependency cycles between interdependent parameters. These cycles can cause undesired behavior that is difficult to debug, especially if it only occurs in certain circumstances such as when loading particular presets.</li>
</ul>
<p>In all of these cases, a plug-in should provide consistent linked parameter behavior: every automated playback pass should be identical, parameters should never "fight" one another or trigger rapid and unexpected changes in other parameters, parameters should not become "stuck" in a particular state, etc.</p>
<div class="image">
<img src="AutoOverwritePencil.png"  width="40%" alt="Here comes trouble"/>
</div>
 <div class="imagecaption">Here comes trouble</div><h2><a class="anchor" id="linkedParameters_behavior"></a>
Defining proper linked parameter behavior</h2>
<p>A good way to approach parameter linking is to start with an understanding of exactly what behavior you desire.</p>
<p>Here are some behaviors that you probably <em>don't</em> want in your plug-in:</p>
<ul class="paragraphs">
<li>
<div class="SectionHead">BAD: Parameters are only linked when edited from the plug-in GUI </div> Users may attempt to edit linked parameters from attached control surfaces or using the host's automation features. The parameters should behave the same way regardless of which method is used to edit them.  </li>
<li>
<div class="SectionHead">BAD: Parameters try to match all automation data </div> Automation data can be written arbitrarily: Pro Tools doesn't have any restrictions that a user with a pencil tool must draw inside the lines, or a user may attempt to edit multiple parameters on an attached control surface simultaneously. Any parameter that attempts to match both its own automation data and the automation data of another parameter, or any parameter that attempts to set another automatable parameter's state based on its own automation data, will lead to "fighting" during playback of non-conformant automation.  </li>
<li>
<div class="SectionHead">BAD: Automation data is only written to one lane at a time </div> One approach to parameter linking may be to only write automation data to a single parameter at a time. This could be the parameter that is currently being touched and edited, or it could be a dedicated "master" parameter within the linked group. While this approach can be used to solve some types of conflicts, it can still lead to unnecessarily complex or inconsistent behavior in certain situations: for example, arbitrary automation data can still be written to multiple parameters' automation lanes, or a user can choose to record automation for only one parameter in a set but can skip the "master" parameter. Furthermore, it is difficult if not impossible to properly handle parameters that can be dynamically linked or un-linked using this approach.  </li>
</ul>
<p>With those potential problems in mind, here is a description of how parameter linking <em>should</em> behave.</p>
<h3><a class="anchor" id="linkedParamters_behavior_correct"></a>
Correct behavior for linked parameters</h3>
<p><em class="Bold">Notes</em></p><ul>
<li>In this proposal (and throughout the rest of this page) the term "linker" will refer to a parameter that initiates a change and the term "linked" will refer to a dependent parameter that receives the change.</li>
<li>The following discussion will focus on <em class="Bold">automatable</em> parameters that are <em class="Bold">reciprocally linked</em>. This case tends to be the most complex, with the greatest need for consistency of implementation.</li>
</ul>
<p><em class="Bold">During user-generated real-time edits</em> (from the plug-in GUI or a control surface) both the linker and the linked parameters should be updated. Without this requirement, there would be no parameter linking. In order for this requirement to be enforced consistently the following behaviors must be maintained: </p><ul>
<li>
The linked parameter should not jump to a new value if the user attempts to edit both parameters simultaneously using a control surface.  </li>
<li>
To ensure proper automation playback, automation should be written to both the linker and the linked parameters.  </li>
</ul>
<p><em class="Bold">When playing back automation</em>, parameters should operate independently and should not attempt to force dependent parameters to a new state. This prevents fighting in the presence of incompatible automation and ensures deterministic automation playback with every playback pass. As above, there are some more subtle behaviors that must be maintained for this to work properly: </p><ul>
<li>
If the user begins a real-time edit during automation playback then the parameter linking behavior should resume as described above  </li>
<li>
If the plug-in's algorithm cannot support certain parameter configurations then its automatable parameters should be decoupled from the algorithm using a set of coefficients that is aware of the algorithm's constraints. In this way every combination of parameter states can map to a particular coefficient state, maintaining determinism, and incompatible parameter combinations can simply resolve to the "closest" match in the possible coefficient space during playback of edited parameter automation data. </li>
<li>
Another, simpler approach for plug-ins that do not support arbitrary parameter configurations is to ensure that the problematic parameters are not automatable. Handling non-automatable parameter linking is much easier in general, so consider this approach if automation is not a requirement for some of your plug-in's parameters.  </li>
</ul>
<p><em class="Bold">When handling preset changes and plug-in initialization</em>, a similar approach should be taken as with plug-in automation playback. In these cases it is very unlikely that the plug-in's parameters will be left in an incompatible state and attempts at linking may result in unwanted update cycles between inter-dependent parameters or unnecessary coefficient churn. This latter concern can be a real problem for AAX DSP plug-ins that initialize internal algorithmic state based on initial coefficient data.</p>
<h3><a class="anchor" id="linkedParamters_behavior_caveat"></a>
Compatibility caveat</h3>
<p>This behavior was not possible under the RTAS/TDM format, and many RTAS and TDM plug-ins reverted to workarounds such as writing automation to only one parameter at a time and linking the parameters during playback. Therefore, plug-ins that previously supported linked automatable parameters under the RTAS/TDM format may not be able to both implement this recommended parameter linking behavior and maintain compatibility with automation in saved sessions.</p>
<p>Most of Avid's plug-ins that were available in the RTAS and TDM formats fall into this category and should not be used as examples of proper parameter linking behavior. Instead, use the SDK's DemoGain_LinkedParameters example plug-in as an example of proper linked parameter operation.</p>
<h1><a class="anchor" id="linkedParameters_linkedParameterOperation"></a>
Linked Parameter Operation</h1>
<p>As described above, the key rule for linked parameters is to link during real-time user edits <em>only</em>, and should operate the parameters independently (without linked behavior) during automation playback and preset restore. This rule will simplify many issues: it will prevent conflicts with automation data, avoid potentially strange behaviors when restoring presets, and more.</p>
<p>Here is how the system works WITH linked parameters, using code snippets from the DemoGain_LinkedParameters example plug-in:</p>
<h2><a class="anchor" id="linkedParameters_linkedParameterOperation_userEditing"></a>
User Editing</h2>
<ol type="1">
<li>User clicks on a parameter in the GUI or grabs a parameter on the controls surface. A TOUCH token should be sent at this point.<ul>
<li>The touched parameter status comes back to the plug-in. If the parameters are linked the other linked parameter should have a TOUCH token sent. This really should only be done for linked continuous parameters. This is done by overriding the <a class="el" href="a00018.html#a1555fe9834764330bd264941a1d6ebc3" title="Sets a &quot;touched&quot; state on a parameter. ">AAX_CEffectParameters::UpdateParameterTouch()</a> method.</li>
</ul>
</li>
<li>The user changes the parameter from the GUI or controls surface. A SET token should be sent at this point. <div class="fragment"><div class="line"><span class="comment">// *******************************************************************************</span></div>
<div class="line"><span class="comment">// METHOD:  UpdateParameterTouch</span></div>
<div class="line"><span class="comment">// *******************************************************************************</span></div>
<div class="line"><a class="code" href="a00149.html#a4d8f69a697df7f70c3a8e9b8ee130d2f">AAX_Result</a> DemoGain_Parameters::UpdateParameterTouch ( <a class="code" href="a00149.html#a1440c756fe5cb158b78193b2fc1780d1">AAX_CParamID</a> inParameterID, <a class="code" href="a00149.html#aa216506530f1d19a2965931ced2b274b">AAX_CBoolean</a> inTouchState )</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> ( inTouchState )</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="a00149.html#a1440c756fe5cb158b78193b2fc1780d1">AAX_CParamID</a> linkedControl = this-&gt;GetLinkedControl ( inParameterID );</div>
<div class="line">        <span class="keywordflow">if</span> ( linkedControl )</div>
<div class="line">        {</div>
<div class="line">            this-&gt;TouchParameter ( linkedControl );</div>
<div class="line">            mLinkTouchMap.insert ( std::pair&lt;std::string,std::string&gt;( inParameterID, linkedControl ) );</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    [...]</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li>The SET token goes into the system and comes back to the plugin via <a class="el" href="a00018.html#a56a9f41a975b48f583655db7b43aae5a" title="Updates a single parameter&#39;s state to its current value. ">AAX_CEffectParameters::UpdateParameterNormalizedValue()</a>.<ul>
<li>If the parameter is linked then the other linked parameter should have its value set for its linked behaviour. The system knows this is a linked parameter so when the value comes back to the plug-in via UpdateParameterNormalizedValue() it will know not to perform linked behaviors on that value change. To determine if a parameter should set a linked parameter you check it with the <a class="el" href="a00018.html#af5445bb9f40ccf826227199647e140ee">AAX_CEffectParameters::IsParameterTouched()</a> method.</li>
</ul>
</li>
<li>The plug-in updates its internal state and sends an UPDATE tokens for both parameters. <div class="fragment"><div class="line"><span class="comment">// *******************************************************************************</span></div>
<div class="line"><span class="comment">// METHOD:  UpdateParameterNormalizedValue</span></div>
<div class="line"><span class="comment">// *******************************************************************************</span></div>
<div class="line"><a class="code" href="a00149.html#a4d8f69a697df7f70c3a8e9b8ee130d2f">AAX_Result</a> DemoGain_Parameters::UpdateParameterNormalizedValue ( <a class="code" href="a00149.html#a1440c756fe5cb158b78193b2fc1780d1">AAX_CParamID</a> inParameterID, <span class="keywordtype">double</span> inValue, <a class="code" href="a00206.html#a30be0398faf20c6b121239eb9399f3f7">AAX_EUpdateSource</a> inSource )</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="a00149.html#a4d8f69a697df7f70c3a8e9b8ee130d2f">AAX_Result</a>  result = <a class="code" href="a00018.html#a56a9f41a975b48f583655db7b43aae5a">AAX_CEffectParameters::UpdateParameterNormalizedValue</a> ( inParameterID, inValue, inSource );</div>
<div class="line">    <span class="keywordtype">bool</span>        touched = this-&gt;IsParameterTouched ( inParameterID );</div>
<div class="line"></div>
<div class="line">    [...]</div>
<div class="line">                <span class="keywordflow">if</span> ( touched &amp;&amp; inSource == <a class="code" href="a00206.html#a30be0398faf20c6b121239eb9399f3f7aec16143f3916bad3c5a6d8eb60600a3b">AAX_eUpdateSource_Unspecified</a> )</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">if</span> ( type == eType_Pan )</div>
<div class="line">                        this-&gt;SetParameterNormalizedValue( linkedControl, (1.0 - inValue) );</div>
<div class="line">                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( type == eType_Gain )</div>
<div class="line">                        this-&gt;SetParameterNormalizedValue( linkedControl, inValue );</div>
<div class="line">                }</div>
<div class="line">    [...]</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li>Repeat steps 2-4 while changing the parameter.</li>
<li>The user lets go of the GUI or controls surface. A TOUCH token with the released state should be sent.<ul>
<li>The touched parameter status comes back to the plug-in. If the parameters were linked the other linked parameter should have a TOUCH token with the release status sent. This again is done by overriding the <a class="el" href="a00018.html#a1555fe9834764330bd264941a1d6ebc3" title="Sets a &quot;touched&quot; state on a parameter. ">AAX_CEffectParameters::UpdateParameterTouch()</a> method. <div class="fragment"><div class="line"><span class="comment">// *******************************************************************************</span></div>
<div class="line"><span class="comment">// METHOD:  UpdateParameterTouch</span></div>
<div class="line"><span class="comment">// *******************************************************************************</span></div>
<div class="line"><a class="code" href="a00149.html#a4d8f69a697df7f70c3a8e9b8ee130d2f">AAX_Result</a> DemoGain_Parameters::UpdateParameterTouch ( <a class="code" href="a00149.html#a1440c756fe5cb158b78193b2fc1780d1">AAX_CParamID</a> inParameterID, <a class="code" href="a00149.html#aa216506530f1d19a2965931ced2b274b">AAX_CBoolean</a> inTouchState )</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> ( inTouchState )</div>
<div class="line">    {</div>
<div class="line">        [...]</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        [...]</div>
<div class="line">            this-&gt;ReleaseParameter ( iter-&gt;second.c_str () );</div>
<div class="line">        [...]</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="a00207.html#a5f8c7439f3a706c4f8315a9609811937aeddbd1bb67e3a66e6af54a4b4a7a57b3">AAX_SUCCESS</a>;</div>
<div class="line">}</div>
</div><!-- fragment --></li>
</ul>
</li>
</ol>
<h2><a class="anchor" id="linkedParameters_linkedParameterOperation_automationPlayback"></a>
Automation Playback</h2>
<ol type="1">
<li>The SET token comes from the automation system and enters the plugin via <a class="el" href="a00061.html#a685858711efb8634ce66c327f2865c71">UpdateParameterNormalizedValue()</a>.<ul>
<li>The plug-in will know this is not from the user editing therefore it will NOT set the other linked parameter. Remember ONLY LINK USER EDITING. That way there's no conflicts if the user edited the automation or if the order in which automation arrives at the plug-in changes.</li>
</ul>
</li>
<li>The plug-in updates its internal state and sends an UPDATE token.</li>
<li>Repeat steps 1-2 while playing back automation.</li>
</ol>
<h2><a class="anchor" id="linkedParameters_linkedParameterOperation_chunkRestoring"></a>
Chunk Restoring</h2>
<ol type="1">
<li>Plug-in loads the chuck.</li>
<li>The plug-in sets every parameters value.</li>
<li>The SET tokens comes back to the plugin via UpdateParameterNormalizedValue().<ul>
<li>The plug-in will know this is not from the user editing therefore it will NOT set the other linked parameter. Remember ONLY LINK USER EDITING. Hopefully the result of this is that the contents of the chunk will be restored to its exact state.</li>
</ul>
</li>
<li>The plug-in updates its internal state and sends out UPDATE tokens.</li>
</ol>
<h1><a class="anchor" id="linkedParameters_changingTapers"></a>
Changing Tapers</h1>
<p>One common use of linked parameters is to change the taper associated with a parameter. For changing tapers there are basically only a two rules you need to follow:</p>
<ol type="1">
<li>When you're loading a new chunk you need to set the taper values first. If a parameter is what updates the taper then set that value first. That way when the value of a parameter is set from a chunk it wont change because of a taper change.</li>
<li>Update the taper from the UpdateParameterNormalizedValue() method. If the new taper needs to change the value of the parameter you only do so if the user is editing the linked parameter. This still follows the ONLY LINK USER EDITING rule.</li>
</ol>
<div class="fragment"><div class="line"><a class="code" href="a00149.html#a4d8f69a697df7f70c3a8e9b8ee130d2f">AAX_Result</a> Simple_Parameters::UpdateParameterNormalizedValue ( <a class="code" href="a00149.html#a1440c756fe5cb158b78193b2fc1780d1">AAX_CParamID</a> inParameterID, <span class="keywordtype">double</span> inValue, <a class="code" href="a00206.html#a30be0398faf20c6b121239eb9399f3f7">AAX_EUpdateSource</a> inSource )</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// GetLinkedControl() is a user defined method which determines the linked control ID.</span></div>
<div class="line">    <a class="code" href="a00149.html#a1440c756fe5cb158b78193b2fc1780d1">AAX_CParamID</a> linkedControl = this-&gt;GetLinkedControl ( inParameterID );</div>
<div class="line">    <span class="keywordflow">if</span> ( linkedControl )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// IsParameterLinkReady()* is a built in method of AAX_CEffectParameters which determines if the </span></div>
<div class="line">        <span class="comment">// parameter should perform linked behaviors based on the touch state of the parameter and the </span></div>
<div class="line">        <span class="comment">// source of the UpdateParameterNormalizedValue() call.</span></div>
<div class="line">        <span class="keywordflow">if</span> ( this-&gt;IsParameterLinkReady ( inParameterID, inSource ) )</div>
<div class="line">            this-&gt;SetParameterNormalizedValue( linkedControl, inValue );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Call the inherited method for the original parameter</span></div>
<div class="line">    <a class="code" href="a00149.html#a4d8f69a697df7f70c3a8e9b8ee130d2f">AAX_Result</a>   result = <a class="code" href="a00018.html#a56a9f41a975b48f583655db7b43aae5a">AAX_CEffectParameters::UpdateParameterNormalizedValue</a> ( inParameterID, inValue, inSource );</div>
<div class="line">    <span class="keywordflow">return</span> result;</div>
<div class="line">}</div>
</div><!-- fragment --> <div class="dynheader">
Collaboration diagram for Linked parameters:</div>
<div class="dyncontent">
<center><table><tr><td><img src="a00354.png" border="0" alt="" usemap="#a00354"/>
<map name="a00354" id="a00354">
<area shape="rect" id="node1" href="a00350.html" title="The anatomy of a parameter update. " alt="" coords="5,5,141,32"/></map>
</td></tr></table></center>
</div>
</div><!-- contents -->
<!--        Copyright 2016, 2018 by Avid Technology, Inc.        -->
<!-- HTML footer for doxygen 1.8.9.1-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
<div class="FooterLegal">This product may be protected by one or more U.S. and non-U.S. patents. Details are available at <a href="https://www.avid.com/patents">www.avid.com/patents</a>.</div>
Generated on Fri Feb 2 2018 21:14:56 for AAX SDK by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
